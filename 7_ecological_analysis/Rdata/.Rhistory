# Chunk 1: setup
library(tidyverse)
library(lubridate)
library(readr)
library(arsenal)
library(labelled)
# Chunk 2
setwd("~/Dropbox/Working_docs/Roslin_Greenland/2017/bulk_samples/ArcDyn_scripts/7_ecological_analysis/Rdata")
load("input_data_step5_20190204.RData")
# mock soup datasets
mockdf <- left_join(mock_design, species, by = c("input_sp" = "sp")) %>%
select(sample, experiment, run, input_amount, Order, Family, Genus, Species_BOLD, mitogenome) %>%
filter(experiment != "negctrl" & run == 2 & str_starts(sample, "PlateGH")) %>%
mutate(
Species_BOLD = case_when(
input_amount == 0.2 ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI_SPIKE_0.2",
input_amount == 0.4 ~ "Coleoptera_Mordellidae_COI_SPIKE_0.4",
input_amount == 0.8 ~ "Coleoptera_Elateridae_COI_SPIKE_0.8",
TRUE ~ as.character(Species_BOLD)
)
) %>%
select(-run) %>%
arrange(sample, desc(input_amount)) %>%
mutate(
sample = str_remove(sample, "_2")
) %>%
set_variable_labels(input_amount = "ng") # labelled::set_variable_labels
View(mockdf)
# environmental datasets
mergedf <- left_join(env_data_mitogenome, env_design)
mergedf <- left_join(mergedf, species)
mergedf <- mergedf %>% filter(run == "idx_meta_genomecov_GH")
mergedf <- mergedf %>% select(sample, COI, everything())
mergesumm <- function(x) {
df <- mergedf %>%
filter(year(date) == x) %>%
mutate(
COI = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI_SPIKE_0.2",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI_SPIKE_0.4",
sp == "spike3" ~ "Coleoptera_Elateridae_COI_SPIKE_0.8",
TRUE ~ as.character(COI)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
group_by(COI) %>%
summarise(
max_PC = max(PC),
sum_mapped_reads=sum(mapped_reads),
Order = first(Order),
Family = first(Family),
Genus = first(Genus),
Species_BOLD = first(Species_BOLD),
mitogenome = first(mitogenome)
) %>%
arrange(desc(sum_mapped_reads)) %>%
labelled::set_variable_labels(COI = "barcode seq name", max_PC = "% cov mapped to seq", sum_mapped_reads = "measure of DNA biomass")
df
}
mergedf2003 <- mergesumm(2003)
mergedf2004 <- mergesumm(2004)
mergedf2005 <- mergesumm(2005)
View(mergedf2003)
View(mergedf2003)
View(mergedf2005)
View(mergedf2003)
