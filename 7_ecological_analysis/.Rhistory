filter(experiment != "negctrl" & run == 1) %>%
mutate(
mitogenome = case_when(
input_amount == 0.2 ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
input_amount == 0.4 ~ "Coleoptera_Mordellidae_COI",
input_amount == 0.8 ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
)
View(mockdf)
# mockdf
mockdf <- left_join(mock_design, species, by = c("input_sp" = "sp")) %>%
select(sample, experiment, run, input_amount, mitogenome, BOLD, Order, Family, Genus, Species_BOLD, mitogenome) %>%
filter(experiment != "negctrl" & run == 1) %>%
mutate(
mitogenome = case_when(
input_amount == 0.2 ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
input_amount == 0.4 ~ "Coleoptera_Mordellidae_COI",
input_amount == 0.8 ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
select(-run)
View(mockdf)
# mockdf
mockdf <- left_join(mock_design, species, by = c("input_sp" = "sp")) %>%
select(sample, experiment, run, input_amount, mitogenome, BOLD, Order, Family, Genus, Species_BOLD, mitogenome) %>%
filter(experiment != "negctrl" & run == 2) %>%
mutate(
mitogenome = case_when(
input_amount == 0.2 ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
input_amount == 0.4 ~ "Coleoptera_Mordellidae_COI",
input_amount == 0.8 ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
select(-run)
View(mockdf)
# mockdf
mockdf <- left_join(mock_design, species, by = c("input_sp" = "sp")) %>%
select(sample, experiment, run, input_amount, mitogenome, BOLD, Order, Family, Genus, Species_BOLD, mitogenome) %>%
filter(experiment != "negctrl" & run == 2 & str_starts("PlateGH")) %>%
mutate(
mitogenome = case_when(
input_amount == 0.2 ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
input_amount == 0.4 ~ "Coleoptera_Mordellidae_COI",
input_amount == 0.8 ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
select(-run)
# mockdf
mockdf <- left_join(mock_design, species, by = c("input_sp" = "sp")) %>%
select(sample, experiment, run, input_amount, mitogenome, BOLD, Order, Family, Genus, Species_BOLD, mitogenome) %>%
filter(experiment != "negctrl" & run == 2 & str_starts(sample, "PlateGH")) %>%
mutate(
mitogenome = case_when(
input_amount == 0.2 ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
input_amount == 0.4 ~ "Coleoptera_Mordellidae_COI",
input_amount == 0.8 ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
select(-run)
View(mockdf)
# mockdf
mockdf <- left_join(mock_design, species, by = c("input_sp" = "sp")) %>%
select(sample, experiment, run, input_amount, mitogenome, BOLD, Order, Family, Genus, Species_BOLD, mitogenome) %>%
filter(experiment != "negctrl" & run == 2 & str_starts(sample, "PlateGH")) %>%
mutate(
mitogenome = case_when(
input_amount == 0.2 ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
input_amount == 0.4 ~ "Coleoptera_Mordellidae_COI",
input_amount == 0.8 ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
select(-run) %>%
arrange(sample, input_amount)
View(mockdf)
mergedf <- left_join(env_data_mitogenome, env_design)
mergedf <- left_join(mergedf, species)
mergedf <- mergedf %>% filter(run == "idx_meta_genomecov_GH")
mergedf <- mergedf %>% select(sample, mitogenome, everything())
mergedf2003 <- mergedf %>%
filter(year(date) == 2003) %>%
mutate(
mitogenome = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(mitogenome, PC, mapped_reads, Order, Family, Genus, Species_BOLD, COI) %>%
arrange(mitogenome, desc(PC))
mergedf2004 <- mergedf %>%
filter(year(date) == 2004) %>%
mutate(
mitogenome = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(mitogenome, PC, mapped_reads, Order, Family, Genus, Species_BOLD, COI) %>%
arrange(mitogenome, desc(PC))
mergedf2005 <- mergedf %>%
filter(year(date) == 2005) %>%
mutate(
mitogenome = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(mitogenome, PC, mapped_reads, Order, Family, Genus, Species_BOLD, COI) %>%
arrange(mitogenome, desc(PC))
rm(mergedf)
mainDir = "~/Dropbox/Working_docs/Kelpie"
filename = "Kelpie_datasets.RData"
stop("File can't be saved because a file with that name already exists.")
if(file_test("-f", file.path(mainDir, filename))) {  # test if file already exists "-f"
stop("File can't be saved because a file with that name already exists.")
} else {
save(mockdf, mergedf2003, mergedf2004, mergedf2005, file = filename)
}
mainDir = "~/Dropbox/Working_docs/Kelpie"
filename = "Kelpie_datasets.RData"
if(file_test("-f", file.path(mainDir, filename))) {  # test if file already exists "-f"
stop("File can't be saved because a file with that name already exists.")
} else {
save(mockdf, mergedf2003, mergedf2004, mergedf2005, file = filename)
}
filename = "Kelpie_datasets_20190419.RData"
if(file_test("-f", file.path(mainDir, filename))) {  # test if file already exists "-f"
stop("File can't be saved because a file with that name already exists.")
} else {
save(mockdf, mergedf2003, mergedf2004, mergedf2005, file = filename)
}
save(mockdf, mergedf2003, mergedf2004, mergedf2005, file = "Kelpie_datasets_20190419.RData")
save(mockdf, mergedf2003, mergedf2004, mergedf2005, file = file.path(mainDir, filename))
View(mergedf2003)
names(mergedf2003)
mergedf2003summ <- mergedf2003 %>%
group_by(mitogenome) %>%
summarise(
PC = max(PC),
sum_mapped_reads=sum(mapped_reads),
Order = first(Order),
Family = first(Family),
Genus = first(Genus),
Species_BOLD = first(Species_BOLD),
COI = first(COI)
)
View(mergedf2003summ)
mergedf <- left_join(env_data_mitogenome, env_design)
mergedf <- left_join(mergedf, species)
mergedf <- mergedf %>% filter(run == "idx_meta_genomecov_GH")
mergedf <- mergedf %>% select(sample, COI, everything())
mergedf2003 <- mergedf %>%
filter(year(date) == 2003) %>%
mutate(
mitogenome = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(mitogenome, PC, mapped_reads, Order, Family, Genus, Species_BOLD, COI) %>%
arrange(mitogenome, desc(PC))
mergedf2004 <- mergedf %>%
filter(year(date) == 2004) %>%
mutate(
mitogenome = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(mitogenome, PC, mapped_reads, Order, Family, Genus, Species_BOLD, COI) %>%
arrange(mitogenome, desc(PC))
mergedf2005 <- mergedf %>%
filter(year(date) == 2005) %>%
mutate(
mitogenome = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(mitogenome, PC, mapped_reads, Order, Family, Genus, Species_BOLD, COI) %>%
arrange(mitogenome, desc(PC))
rm(mergedf)
mergedf2003summ <- mergedf2003 %>%
group_by(mitogenome) %>%
summarise(
PC = max(PC),
sum_mapped_reads=sum(mapped_reads),
Order = first(Order),
Family = first(Family),
Genus = first(Genus),
Species_BOLD = first(Species_BOLD),
COI = first(COI)
)
View(mergedf2003)
mergedf <- left_join(env_data_mitogenome, env_design)
mergedf <- left_join(mergedf, species)
mergedf <- mergedf %>% filter(run == "idx_meta_genomecov_GH")
mergedf <- mergedf %>% select(sample, COI, everything())
View(mergedf)
mergedf2003 <- mergedf %>%
filter(year(date) == 2003) %>%
mutate(
mitogenome = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(COI, PC, mapped_reads, Order, Family, Genus, Species_BOLD, mitogenome) %>%
arrange(COI, desc(PC))
View(mergedf2003)
mergedf2003 <- mergedf %>%
filter(year(date) == 2003) %>%
mutate(
mitogenome = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(COI, PC, mapped_reads, Order, Family, Genus, Species_BOLD, mitogenome) %>%
arrange(COI, desc(PC)) %>%
group_by(mitogenome) %>%
summarise(
PC = max(PC),
sum_mapped_reads=sum(mapped_reads),
Order = first(Order),
Family = first(Family),
Genus = first(Genus),
Species_BOLD = first(Species_BOLD),
COI = first(COI)
)
View(mergedf2003)
mergedf2003 <- mergedf %>%
filter(year(date) == 2003) %>%
mutate(
mitogenome = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(COI, PC, mapped_reads, Order, Family, Genus, Species_BOLD, mitogenome) %>%
arrange(COI, desc(PC)) %>%
group_by(COI) %>%
summarise(
PC = max(PC),
sum_mapped_reads=sum(mapped_reads),
Order = first(Order),
Family = first(Family),
Genus = first(Genus),
Species_BOLD = first(Species_BOLD),
COI = first(COI)
)
mergedf2003 <- mergedf %>%
filter(year(date) == 2003) %>%
mutate(
mitogenome = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(COI, PC, mapped_reads, Order, Family, Genus, Species_BOLD, mitogenome) %>%
arrange(COI, desc(PC)) %>%
group_by(COI) %>%
summarise(
PC = max(PC),
sum_mapped_reads=sum(mapped_reads),
Order = first(Order),
Family = first(Family),
Genus = first(Genus),
Species_BOLD = first(Species_BOLD),
mitogenome = first(mitogenome)
)
View(mergedf2003)
View(mergedf)
mergedf2003 <- mergedf %>%
filter(year(date) == 2003) %>%
mutate(
COI = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(COI, PC, mapped_reads, Order, Family, Genus, Species_BOLD, mitogenome) %>%
arrange(COI, desc(PC)) %>%
group_by(COI) %>%
summarise(
PC = max(PC),
sum_mapped_reads=sum(mapped_reads),
Order = first(Order),
Family = first(Family),
Genus = first(Genus),
Species_BOLD = first(Species_BOLD),
mitogenome = first(mitogenome)
)
mergedf2003 <- mergedf %>%
filter(year(date) == 2003) %>%
mutate(
COI = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(COI, PC, mapped_reads, Order, Family, Genus, Species_BOLD, mitogenome) %>%
group_by(COI) %>%
summarise(
PC = max(PC),
sum_mapped_reads=sum(mapped_reads),
Order = first(Order),
Family = first(Family),
Genus = first(Genus),
Species_BOLD = first(Species_BOLD),
mitogenome = first(mitogenome)
) %>%
arrange(desc(PC))
View(mergedf2003)
mergedf2003 <- mergedf %>%
filter(year(date) == 2003) %>%
mutate(
COI = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(COI, PC, mapped_reads, Order, Family, Genus, Species_BOLD, mitogenome) %>%
group_by(COI) %>%
summarise(
PC = max(PC),
sum_mapped_reads=sum(mapped_reads),
Order = first(Order),
Family = first(Family),
Genus = first(Genus),
Species_BOLD = first(Species_BOLD),
mitogenome = first(mitogenome)
) %>%
arrange(desc(sum_mapped_reads))
View(mergedf2003)
mergesumm(2003)
mergesumm <- function(x) {
df <- mergedf %>%
filter(year(date) == x) %>%
mutate(
COI = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(COI, PC, mapped_reads, Order, Family, Genus, Species_BOLD, mitogenome) %>%
group_by(COI) %>%
summarise(
PC = max(PC),
sum_mapped_reads=sum(mapped_reads),
Order = first(Order),
Family = first(Family),
Genus = first(Genus),
Species_BOLD = first(Species_BOLD),
mitogenome = first(mitogenome)
) %>%
arrange(desc(sum_mapped_reads))
df
}
mergesumm(2003)
mergedf2003 <- mergesumm(2003)
View(mergedf2003)
mergedf2004test <- mergesumm(2004)
mergedf2005test <- mergesumm(2005)
mergedf2003 <- mergedf %>%
filter(year(date) == 2003) %>%
mutate(
COI = case_when(
sp == "spike1" ~ "Lepidoptera_Bombycidae_Bombyx_mori_COI",
sp == "spike2" ~ "Coleoptera_Mordellidae_COI",
sp == "spike3" ~ "Coleoptera_Elateridae_COI",
TRUE ~ as.character(mitogenome)
)
) %>%
mutate(
PC = case_when(
str_starts(sp, "spike") == TRUE ~ 1.0,
TRUE ~ as.numeric(PC)
)
) %>%
distinct(COI, PC, mapped_reads, Order, Family, Genus, Species_BOLD, mitogenome) %>%
group_by(COI) %>%
summarise(
PC = max(PC),
sum_mapped_reads=sum(mapped_reads),
Order = first(Order),
Family = first(Family),
Genus = first(Genus),
Species_BOLD = first(Species_BOLD),
mitogenome = first(mitogenome)
) %>%
arrange(desc(sum_mapped_reads))
mergedf2003test <- mergesumm(2003)
library(arsenal)
library(arsenal)
